import*as e from"./opencv.js";import*as t from"./openhps-core.es.min.js";var r={d:(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},i={};r.d(i,{Xk:()=>ArucoMarkerNode,Fh:()=>d,$E:()=>ColorMaskNode,eB:()=>l,PS:()=>S,gS:()=>f,wk:()=>ImageDilateNode,sY:()=>ImageDisplaySink,CW:()=>ImageErodeNode,s4:()=>h,WH:()=>g,yb:()=>ImageProcessingNode,o9:()=>c,h7:()=>m,Tn:()=>p,yA:()=>b,aT:()=>y,_9:()=>Uint8ImageToMat,lc:()=>u,LG:()=>VideoSource,cv:()=>s,j2:()=>v});const s=e;const a=(e=>{var t={};return r.d(t,e),t})({DataFrame:()=>t.DataFrame,DataObject:()=>t.DataObject,DataSerializer:()=>t.DataSerializer,LengthUnit:()=>t.LengthUnit,Matrix3:()=>t.Matrix3,ProcessingNode:()=>t.ProcessingNode,SerializableArrayMember:()=>t.SerializableArrayMember,SerializableMember:()=>t.SerializableMember,SerializableObject:()=>t.SerializableObject,SinkNode:()=>t.SinkNode,SourceNode:()=>t.SourceNode,TimeService:()=>t.TimeService,TimeUnit:()=>t.TimeUnit});function o(e,t,r,i){var s,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}function n(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;let c=class ImageRectShape extends s.Rect{constructor(e){super(e.x,e.y,e.width,e.height)}get center(){return null}get squareSize(){return this.width*this.height}};c=o([(0,a.SerializableObject)(),n("design:paramtypes",[s.Rect])],c);let h=class ImageFeatureObject extends a.DataObject{constructor(){super(...arguments),this._containedFeatures=new Array}get confidence(){return this._confidence}set confidence(e){this._confidence=e}get shape(){return this._shape}set shape(e){this._shape=e}};o([(0,a.SerializableArrayMember)(h),n("design:type",Array)],h.prototype,"_containedFeatures",void 0),o([(0,a.SerializableMember)(),n("design:type",Number),n("design:paramtypes",[Number])],h.prototype,"confidence",null),o([(0,a.SerializableMember)(),n("design:type",c),n("design:paramtypes",[c])],h.prototype,"shape",null),h=o([(0,a.SerializableObject)()],h);let d=class CameraObject extends a.DataObject{get focalLength(){if(this.cameraMatrix)return[this.cameraMatrix.elements[0],this.cameraMatrix.elements[4]]}get principalPoint(){if(this.cameraMatrix)return[this.cameraMatrix.elements[6],this.cameraMatrix.elements[7]]}get aspect(){return this.width/this.height}get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}constructor(e,t,r,i){var s;super(e,t),this.colorOrder=l.RGB,this.width=r||0,this.height=i||0,this.distortionCoefficients=null!==(s=this.distortionCoefficients)&&void 0!==s?s:[0,0,0,0,0]}};var l;o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"height",void 0),o([(0,a.SerializableArrayMember)(Number),n("design:type",Array)],d.prototype,"distortionCoefficients",void 0),o([(0,a.SerializableMember)(),n("design:type",a.Matrix3)],d.prototype,"cameraMatrix",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"fps",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"colorOrder",void 0),d=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number])],d),function(e){e[e.RGB=0]="RGB",e[e.BGR=1]="BGR",e[e.GRAYSCALE=2]="GRAYSCALE",e[e.RGBA=3]="RGBA",e[e.BGRA=4]="BGRA"}(l||(l={}));let m=class PerspectiveCameraObject extends d{constructor(e,t,r,i,s=50,a=.1,o=2e3){super(e,t,r,i),this.fov=s,this.near=a,this.far=o}};o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"fov",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"near",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"far",void 0),m=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number,Object,Object,Object])],m);let p=class StereoCameraObject extends d{constructor(e,t,r,i){super(e,t),this.eyeSep=.064,this.cameraL=r,this.cameraR=i,void 0!==r&&void 0!==i&&(this.uid=r.uid+i.uid)}};o([(0,a.SerializableMember)(),n("design:type",m)],p.prototype,"cameraL",void 0),o([(0,a.SerializableMember)(),n("design:type",m)],p.prototype,"cameraR",void 0),o([(0,a.SerializableMember)(),n("design:type",Object)],p.prototype,"eyeSep",void 0),p=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,m,m])],p);let g=class ImageFrame extends a.DataFrame{get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",Object)],g.prototype,"image",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],g.prototype,"height",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],g.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],g.prototype,"fourcc",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],g.prototype,"fps",void 0),g=o([(0,a.SerializableObject)()],g);let u=class VideoFrame extends g{};u=o([(0,a.SerializableObject)()],u);let b=class StereoImageFrame extends a.DataFrame{get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",g)],b.prototype,"left",void 0),o([(0,a.SerializableMember)(),n("design:type",g)],b.prototype,"right",void 0),b=o([(0,a.SerializableObject)()],b);let y=class StereoVideoFrame extends b{};y=o([(0,a.SerializableObject)()],y);let S=class DepthImageFrame extends g{};o([(0,a.SerializableMember)(),n("design:type",Object)],S.prototype,"depth",void 0),o([(0,a.SerializableMember)(),n("design:type",a.LengthUnit)],S.prototype,"depthUnit",void 0),S=o([(0,a.SerializableObject)()],S);let f=class DepthVideoFrame extends S{};function v(){a.DataSerializer.registerType(s.Mat,{serializer:e=>{if(e)return(0,s.imencode)(".jpg",e)},deserializer:e=>{if(e)return(0,s.imdecode)(e)}})}if(f=o([(0,a.SerializableObject)()],f),"object"==typeof window)if(window.cv.Mat)v();else;else v();class VideoSource extends a.SourceNode{constructor(e){super(e),this.frame=0,this.options.sharedImageFrame=void 0===this.options.sharedImageFrame||this.options.sharedImageFrame,this.once("build",this._onBuild.bind(this)),this.once("destroy",this.stop.bind(this))}_onBuild(){this.options.videoSource&&this.load(this.options.videoSource),this.options.autoPlay&&this.play(),this.options.sharedImageFrame&&(this.mat=new s.Mat(this.options.height,this.options.width,s.CV_8UC4))}reset(){this.frame=0}release(){this.mat&&this.mat.delete()}play(){let e=!0;return this.timer=setInterval((()=>{!e&&this.options.throttleRead||(e=!1,this._readFrame().then((t=>t?(this.options.throttlePush||(e=!0),this.push(t)):clearInterval(this.timer))).then((()=>{this.options.throttlePush&&(e=!0)})).catch((e=>{this.logger("error",{ex:e})})))}),-1===this.options.fps?0:1e3/this.options.fps),this.start=Date.now(),this.timer}stop(){this.timer&&clearInterval(this.timer)}get currentFrameCount(){return this.frame}get totalFrameCount(){return this.totalFrames}get actualFPS(){return Math.round(this.frame/((Date.now()-this.start)/1e3)*100)/100}onPull(){return this._readFrame()}_readFrame(){return new Promise(((e,t)=>{const r=new u;r.source=this.source,r.fps=this.options.fps,this.readFrame().then((t=>{if(!t||t.empty())return e(void 0);this.frame++,r.phenomenonTimestamp=a.TimeUnit.SECOND.convert(this.frame*(1/r.fps),a.TimeService.getUnit()),r.rows=this.options.height||t.size().height,r.cols=this.options.width||t.size().width,r.image=t,e(r)})).catch(t)}))}load(e){return this.videoCapture=new s.VideoCapture(e),e instanceof HTMLVideoElement&&(this.options.height=e.videoHeight,this.options.width=e.videoWidth,e.height=e.videoHeight,e.width=e.videoWidth),this}readFrame(){return new Promise(((e,t)=>{let r=this.mat;try{void 0===r&&(r=new s.Mat(this.options.height,this.options.width,s.CV_8UC4)),this.videoCapture.read(r),e(r)}catch(e){null==this.mat&&r.delete(),t(e)}}))}}class ImageProcessingNode extends a.ProcessingNode{constructor(e){super(e)}process(e){return new Promise(((t,r)=>{e.image?this.processImage(e.image,e).then((r=>{e.image=r,t(e)})).catch(r):t(e)}))}}class ColorMaskNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat;s.cvtColor(e,r,s.COLOR_BGR2HSV);const i=new s.Mat,a=s.matFromArray(3,1,s.CV_64FC1,this.options.minRange),o=s.matFromArray(3,1,s.CV_64FC1,this.options.maxRange);s.inRange(r,a,o,i),a.delete(),o.delete(),r.delete(),t(i)}))}}class ImageDilateNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.dilate(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ImageErodeNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.erode(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ArucoMarkerNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{t(e)}))}}class Uint8ImageToMat extends a.ProcessingNode{constructor(e,t){super(t),this.frameType=e}process(e){return new Promise((t=>{const r=new this.frameType(e);r.height=e.height,r.width=e.width;let i=s.CV_8UC4;switch(e.source.colorOrder){case l.RGB:case l.BGR:i=s.CV_8UC3;break;case l.RGBA:case l.BGRA:i=s.CV_8UC4}const a=s.matFromArray(e.height,e.width,i,Array.prototype.slice.call(e.image));r.image=a,t(r)}))}}class ImageDisplaySink extends a.SinkNode{constructor(e){super(e),this.options.canvas=this.options.canvas||"debug"}onPush(e){return new Promise((t=>{s.imshow(this.options.canvas,e.image),t()}))}}var w=i.Xk,M=i.Fh,z=i.$E,N=i.eB,O=i.PS,j=i.gS,I=i.wk,F=i.sY,C=i.CW,P=i.s4,x=i.WH,R=i.yb,A=i.o9,D=i.h7,_=i.Tn,V=i.yA,B=i.aT,G=i._9,T=i.lc,k=i.LG,U=i.cv,L=i.j2;export{w as ArucoMarkerNode,M as CameraObject,z as ColorMaskNode,N as ColorOrder,O as DepthImageFrame,j as DepthVideoFrame,I as ImageDilateNode,F as ImageDisplaySink,C as ImageErodeNode,P as ImageFeatureObject,x as ImageFrame,R as ImageProcessingNode,A as ImageRectShape,D as PerspectiveCameraObject,_ as StereoCameraObject,V as StereoImageFrame,B as StereoVideoFrame,G as Uint8ImageToMat,T as VideoFrame,k as VideoSource,U as cv,L as initialize};
//# sourceMappingURL=openhps-opencv.external.es.min.js.map