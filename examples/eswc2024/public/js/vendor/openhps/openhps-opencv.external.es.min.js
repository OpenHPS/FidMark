import*as e from"./opencv.js";import*as t from"./openhps-core.es.min.js";var r={d:(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},i={};r.d(i,{QN:()=>AbstractVideoSource,Xk:()=>ArucoMarkerNode,Fh:()=>d,$E:()=>ColorMaskNode,eB:()=>l,PS:()=>y,gS:()=>f,wk:()=>ImageDilateNode,sY:()=>ImageDisplaySink,CW:()=>ImageErodeNode,s4:()=>p,WH:()=>u,yb:()=>ImageProcessingNode,o9:()=>c,kl:()=>s,h7:()=>h,Tn:()=>m,yA:()=>g,aT:()=>S,lc:()=>b,LG:()=>VideoSource,j2:()=>v});const s=e;const a=(e=>{var t={};return r.d(t,e),t})({DataFrame:()=>t.DataFrame,DataObject:()=>t.DataObject,DataSerializer:()=>t.DataSerializer,Matrix3:()=>t.Matrix3,ProcessingNode:()=>t.ProcessingNode,SerializableArrayMember:()=>t.SerializableArrayMember,SerializableMember:()=>t.SerializableMember,SerializableObject:()=>t.SerializableObject,SinkNode:()=>t.SinkNode,SourceNode:()=>t.SourceNode,TimeService:()=>t.TimeService,TimeUnit:()=>t.TimeUnit});function o(e,t,r,i){var s,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}function n(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;let c=class ImageRectShape extends s.Rect{constructor(e){super(e.x,e.y,e.width,e.height)}get center(){return null}get squareSize(){return this.width*this.height}};c=o([(0,a.SerializableObject)(),n("design:paramtypes",[s.Rect])],c);let p=class ImageFeatureObject extends a.DataObject{constructor(){super(...arguments),this._containedFeatures=new Array}get confidence(){return this._confidence}set confidence(e){this._confidence=e}get shape(){return this._shape}set shape(e){this._shape=e}};o([(0,a.SerializableArrayMember)(p),n("design:type",Array)],p.prototype,"_containedFeatures",void 0),o([(0,a.SerializableMember)(),n("design:type",Number),n("design:paramtypes",[Number])],p.prototype,"confidence",null),o([(0,a.SerializableMember)(),n("design:type",c),n("design:paramtypes",[c])],p.prototype,"shape",null),p=o([(0,a.SerializableObject)()],p);let d=class CameraObject extends a.DataObject{constructor(e,t,r,i){super(e,t),this.colorOrder=l.RGB,this.width=r||0,this.height=i||0}get focalLength(){if(this.cameraMatrix)return[this.cameraMatrix.elements[0],this.cameraMatrix.elements[4]]}get principalPoint(){if(this.cameraMatrix)return[this.cameraMatrix.elements[6],this.cameraMatrix.elements[7]]}get aspect(){return this.width/this.height}get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}};var l;o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"height",void 0),o([(0,a.SerializableArrayMember)(Number),n("design:type",Array)],d.prototype,"distortionCoefficients",void 0),o([(0,a.SerializableMember)(),n("design:type",a.Matrix3)],d.prototype,"cameraMatrix",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"fps",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],d.prototype,"colorOrder",void 0),d=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number])],d),function(e){e[e.RGB=0]="RGB",e[e.BGR=1]="BGR",e[e.GRAYSCALE=2]="GRAYSCALE"}(l||(l={}));let h=class PerspectiveCameraObject extends d{constructor(e,t,r,i,s=50,a=.1,o=2e3){super(e,t,r,i),this.fov=s,this.near=a,this.far=o}};o([(0,a.SerializableMember)(),n("design:type",Number)],h.prototype,"fov",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],h.prototype,"near",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],h.prototype,"far",void 0),h=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number,Object,Object,Object])],h);let m=class StereoCameraObject extends d{constructor(e,t,r,i){super(e,t),this.eyeSep=.064,this.cameraL=r,this.cameraR=i,void 0!==r&&void 0!==i&&(this.uid=r.uid+i.uid)}};o([(0,a.SerializableMember)(),n("design:type",h)],m.prototype,"cameraL",void 0),o([(0,a.SerializableMember)(),n("design:type",h)],m.prototype,"cameraR",void 0),o([(0,a.SerializableMember)(),n("design:type",Object)],m.prototype,"eyeSep",void 0),m=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,h,h])],m);let u=class ImageFrame extends a.DataFrame{get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",Object)],u.prototype,"image",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"height",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"fourcc",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"fps",void 0),u=o([(0,a.SerializableObject)()],u);let b=class VideoFrame extends u{};b=o([(0,a.SerializableObject)()],b);let g=class StereoImageFrame extends a.DataFrame{get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",u)],g.prototype,"left",void 0),o([(0,a.SerializableMember)(),n("design:type",u)],g.prototype,"right",void 0),g=o([(0,a.SerializableObject)()],g);let S=class StereoVideoFrame extends g{};S=o([(0,a.SerializableObject)()],S);let y=class DepthImageFrame extends u{};o([(0,a.SerializableMember)(),n("design:type",Object)],y.prototype,"depth",void 0),y=o([(0,a.SerializableObject)()],y);let f=class DepthVideoFrame extends y{};function v(){a.DataSerializer.registerType(s.Mat,{serializer:e=>{if(e)return(0,s.imencode)(".jpg",e)},deserializer:e=>{if(e)return(0,s.imdecode)(e)}})}f=o([(0,a.SerializableObject)()],f),"object"==typeof window&&window.cv.Mat,v();class AbstractVideoSource extends a.SourceNode{constructor(e){super(e),this.frame=0,this.once("build",this.onBuild.bind(this)),this.once("destroy",this.stop.bind(this))}onBuild(){this.options.videoSource&&this.load(this.options.videoSource),this.options.autoPlay&&this.play()}load(e){return this.videoCapture=new s.VideoCapture(e),this.srcFPS=this.videoCapture.get(s.CAP_PROP_FPS),this.options.fps=void 0===this.options.fps?this.srcFPS:this.options.fps,this.options.fourcc=this.videoCapture.get(s.CAP_PROP_FOURCC),this.totalFrames=this.videoCapture.get(s.CAP_PROP_FRAME_COUNT),void 0!==this.options.brightness&&this.videoCapture.set(s.CAP_PROP_BRIGHTNESS,this.options.brightness),void 0!==this.options.contrast&&this.videoCapture.set(s.CAP_PROP_CONTRAST,this.options.contrast),-1!==this.options.fps&&this.videoCapture.set(s.CAP_PROP_FPS,this.options.fps),this}reset(){this.frame=0,this.videoCapture.reset()}release(){this.videoCapture.release()}play(){let e=!0;return this.timer=setInterval((()=>{!e&&this.options.throttleRead||(e=!1,this._readFrame().then((t=>t?(this.options.throttlePush||(e=!0),this.push(t)):clearInterval(this.timer))).then((()=>{this.options.throttlePush&&(e=!0)})).catch((e=>{this.logger("error",{ex:e})})))}),-1===this.options.fps?0:1e3/this.options.fps),this.start=Date.now(),this.timer}stop(){this.timer&&clearInterval(this.timer)}get currentFrameCount(){return this.frame}get totalFrameCount(){return this.totalFrames}get actualFPS(){return Math.round(this.frame/((Date.now()-this.start)/1e3)*100)/100}onPull(){return this._readFrame()}_readFrame(){return new Promise(((e,t)=>{const r=new b;r.source=this.source,r.fps=this.options.fps,this.readFrame().then((t=>{if(!t||t.empty)return e(void 0);this.frame++,r.phenomenonTimestamp=a.TimeUnit.SECOND.convert(this.frame*(1/r.fps),a.TimeService.getUnit()),r.rows=this.options.height||t.sizes[0],r.cols=this.options.width||t.sizes[1],r.image=t,r.fourcc=this.options.fourcc,e(r)})).catch(t)}))}}class ImageDisplaySink extends a.SinkNode{constructor(e){super(e),this.options.windowTitle=this.options.windowTitle||"Debug"}onPush(e){return new Promise((t=>{(0,s.imshow)(this.options.windowTitle,e.image),this.options.waitKey&&(0,s.waitKey)(1),t()}))}}class VideoSource extends AbstractVideoSource{load(e){return this.videoCapture=new s.VideoCapture(e),this}readFrame(){return new Promise((e=>{const t=new s.Mat(this.options.height,this.options.width,s.CV_8UC4);this.videoCapture.read(t),e(t)}))}}class ImageProcessingNode extends a.ProcessingNode{constructor(e){super(e)}process(e){return new Promise(((t,r)=>{e.image?this.processImage(e.image,e).then((r=>{e.image!==r&&e.image.delete(),e.image=r,t(e)})).catch(r):t(e)}))}}class ColorMaskNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat;s.cvtColor(e,r,s.COLOR_BGR2HSV);const i=new s.Mat,a=s.matFromArray(3,1,s.CV_64FC1,this.options.minRange),o=s.matFromArray(3,1,s.CV_64FC1,this.options.maxRange);s.inRange(r,a,o,i),a.delete(),o.delete(),r.delete(),t(i)}))}}class ImageDilateNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.dilate(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ImageErodeNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.erode(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ArucoMarkerNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{t(e)}))}}var w=i.QN,P=i.Xk,O=i.Fh,M=i.$E,N=i.eB,C=i.PS,z=i.gS,j=i.wk,F=i.sY,I=i.CW,R=i.s4,x=i.WH,A=i.yb,D=i.o9,_=i.kl,V=i.h7,T=i.Tn,k=i.yA,B=i.aT,G=i.lc,E=i.LG,L=i.j2;export{w as AbstractVideoSource,P as ArucoMarkerNode,O as CameraObject,M as ColorMaskNode,N as ColorOrder,C as DepthImageFrame,z as DepthVideoFrame,j as ImageDilateNode,F as ImageDisplaySink,I as ImageErodeNode,R as ImageFeatureObject,x as ImageFrame,A as ImageProcessingNode,D as ImageRectShape,_ as OpenCV,V as PerspectiveCameraObject,T as StereoCameraObject,k as StereoImageFrame,B as StereoVideoFrame,G as VideoFrame,E as VideoSource,L as initialize};
//# sourceMappingURL=openhps-opencv.external.es.min.js.map