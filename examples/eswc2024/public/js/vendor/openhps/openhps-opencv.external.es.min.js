import*as e from"./opencv.js";import*as t from"./openhps-core.es.min.js";var r={d:(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},i={};r.d(i,{Xk:()=>ArucoMarkerNode,Fh:()=>l,$E:()=>ColorMaskNode,eB:()=>h,PS:()=>S,gS:()=>v,wk:()=>ImageDilateNode,sY:()=>ImageDisplaySink,CW:()=>ImageErodeNode,s4:()=>d,WH:()=>u,yb:()=>ImageProcessingNode,o9:()=>c,h7:()=>m,Tn:()=>p,yA:()=>b,aT:()=>y,lc:()=>g,LG:()=>VideoSource,cv:()=>s,j2:()=>f});const s=e;const a=(e=>{var t={};return r.d(t,e),t})({DataFrame:()=>t.DataFrame,DataObject:()=>t.DataObject,DataSerializer:()=>t.DataSerializer,Matrix3:()=>t.Matrix3,ProcessingNode:()=>t.ProcessingNode,SerializableArrayMember:()=>t.SerializableArrayMember,SerializableMember:()=>t.SerializableMember,SerializableObject:()=>t.SerializableObject,SinkNode:()=>t.SinkNode,SourceNode:()=>t.SourceNode,TimeService:()=>t.TimeService,TimeUnit:()=>t.TimeUnit});function o(e,t,r,i){var s,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(o=(a<3?s(o):a>3?s(t,r,o):s(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o}function n(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}Object.create;Object.create;let c=class ImageRectShape extends s.Rect{constructor(e){super(e.x,e.y,e.width,e.height)}get center(){return null}get squareSize(){return this.width*this.height}};c=o([(0,a.SerializableObject)(),n("design:paramtypes",[s.Rect])],c);let d=class ImageFeatureObject extends a.DataObject{constructor(){super(...arguments),this._containedFeatures=new Array}get confidence(){return this._confidence}set confidence(e){this._confidence=e}get shape(){return this._shape}set shape(e){this._shape=e}};o([(0,a.SerializableArrayMember)(d),n("design:type",Array)],d.prototype,"_containedFeatures",void 0),o([(0,a.SerializableMember)(),n("design:type",Number),n("design:paramtypes",[Number])],d.prototype,"confidence",null),o([(0,a.SerializableMember)(),n("design:type",c),n("design:paramtypes",[c])],d.prototype,"shape",null),d=o([(0,a.SerializableObject)()],d);let l=class CameraObject extends a.DataObject{constructor(e,t,r,i){super(e,t),this.colorOrder=h.RGB,this.width=r||0,this.height=i||0}get focalLength(){if(this.cameraMatrix)return[this.cameraMatrix.elements[0],this.cameraMatrix.elements[4]]}get principalPoint(){if(this.cameraMatrix)return[this.cameraMatrix.elements[6],this.cameraMatrix.elements[7]]}get aspect(){return this.width/this.height}get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}};var h;o([(0,a.SerializableMember)(),n("design:type",Number)],l.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],l.prototype,"height",void 0),o([(0,a.SerializableArrayMember)(Number),n("design:type",Array)],l.prototype,"distortionCoefficients",void 0),o([(0,a.SerializableMember)(),n("design:type",a.Matrix3)],l.prototype,"cameraMatrix",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],l.prototype,"fps",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],l.prototype,"colorOrder",void 0),l=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number])],l),function(e){e[e.RGB=0]="RGB",e[e.BGR=1]="BGR",e[e.GRAYSCALE=2]="GRAYSCALE"}(h||(h={}));let m=class PerspectiveCameraObject extends l{constructor(e,t,r,i,s=50,a=.1,o=2e3){super(e,t,r,i),this.fov=s,this.near=a,this.far=o}};o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"fov",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"near",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],m.prototype,"far",void 0),m=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,Number,Number,Object,Object,Object])],m);let p=class StereoCameraObject extends l{constructor(e,t,r,i){super(e,t),this.eyeSep=.064,this.cameraL=r,this.cameraR=i,void 0!==r&&void 0!==i&&(this.uid=r.uid+i.uid)}};o([(0,a.SerializableMember)(),n("design:type",m)],p.prototype,"cameraL",void 0),o([(0,a.SerializableMember)(),n("design:type",m)],p.prototype,"cameraR",void 0),o([(0,a.SerializableMember)(),n("design:type",Object)],p.prototype,"eyeSep",void 0),p=o([(0,a.SerializableObject)(),n("design:paramtypes",[String,String,m,m])],p);let u=class ImageFrame extends a.DataFrame{get rows(){return this.height}set rows(e){this.height=e}get cols(){return this.width}set cols(e){this.width=e}get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",Object)],u.prototype,"image",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"height",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"width",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"fourcc",void 0),o([(0,a.SerializableMember)(),n("design:type",Number)],u.prototype,"fps",void 0),u=o([(0,a.SerializableObject)()],u);let g=class VideoFrame extends u{};g=o([(0,a.SerializableObject)()],g);let b=class StereoImageFrame extends a.DataFrame{get source(){return super.source}set source(e){super.source=e}};o([(0,a.SerializableMember)(),n("design:type",u)],b.prototype,"left",void 0),o([(0,a.SerializableMember)(),n("design:type",u)],b.prototype,"right",void 0),b=o([(0,a.SerializableObject)()],b);let y=class StereoVideoFrame extends b{};y=o([(0,a.SerializableObject)()],y);let S=class DepthImageFrame extends u{};o([(0,a.SerializableMember)(),n("design:type",Object)],S.prototype,"depth",void 0),S=o([(0,a.SerializableObject)()],S);let v=class DepthVideoFrame extends S{};function f(){a.DataSerializer.registerType(s.Mat,{serializer:e=>{if(e)return(0,s.imencode)(".jpg",e)},deserializer:e=>{if(e)return(0,s.imdecode)(e)}})}if(v=o([(0,a.SerializableObject)()],v),"object"==typeof window)if(window.cv.Mat)f();else;else f();class VideoSource extends a.SourceNode{constructor(e){super(e),this.frame=0,this.options.sharedImageFrame=void 0===this.options.sharedImageFrame||this.options.sharedImageFrame,this.once("build",this._onBuild.bind(this)),this.once("destroy",this.stop.bind(this))}_onBuild(){this.options.videoSource&&this.load(this.options.videoSource),this.options.autoPlay&&this.play(),this.options.sharedImageFrame&&(this.mat=new s.Mat(this.options.height,this.options.width,s.CV_8UC4))}reset(){this.frame=0}release(){this.mat&&this.mat.delete()}play(){let e=!0;return this.timer=setInterval((()=>{!e&&this.options.throttleRead||(e=!1,this._readFrame().then((t=>t?(this.options.throttlePush||(e=!0),this.push(t)):clearInterval(this.timer))).then((()=>{this.options.throttlePush&&(e=!0)})).catch((e=>{this.logger("error",{ex:e})})))}),-1===this.options.fps?0:1e3/this.options.fps),this.start=Date.now(),this.timer}stop(){this.timer&&clearInterval(this.timer)}get currentFrameCount(){return this.frame}get totalFrameCount(){return this.totalFrames}get actualFPS(){return Math.round(this.frame/((Date.now()-this.start)/1e3)*100)/100}onPull(){return this._readFrame()}_readFrame(){return new Promise(((e,t)=>{const r=new g;r.source=this.source,r.fps=this.options.fps,this.readFrame().then((t=>{if(!t||t.empty)return e(void 0);this.frame++,r.phenomenonTimestamp=a.TimeUnit.SECOND.convert(this.frame*(1/r.fps),a.TimeService.getUnit()),r.rows=this.options.height||t.size().height,r.cols=this.options.width||t.size().width,r.image=t,e(r)})).catch(t)}))}load(e){return this.videoCapture=new s.VideoCapture(e),e instanceof HTMLVideoElement&&(this.options.height=e.videoHeight,this.options.width=e.videoWidth,e.height=e.videoHeight,e.width=e.videoWidth),this}readFrame(){return new Promise(((e,t)=>{let r=this.mat;try{void 0===r&&(r=new s.Mat(this.options.height,this.options.width,s.CV_8UC4)),this.videoCapture.read(r),e(r)}catch(e){null==this.mat&&r.delete(),t(e)}}))}}class ImageProcessingNode extends a.ProcessingNode{constructor(e){super(e)}process(e){return new Promise(((t,r)=>{e.image?this.processImage(e.image,e).then((r=>{e.image=r,t(e)})).catch(r):t(e)}))}}class ColorMaskNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat;s.cvtColor(e,r,s.COLOR_BGR2HSV);const i=new s.Mat,a=s.matFromArray(3,1,s.CV_64FC1,this.options.minRange),o=s.matFromArray(3,1,s.CV_64FC1,this.options.maxRange);s.inRange(r,a,o,i),a.delete(),o.delete(),r.delete(),t(i)}))}}class ImageDilateNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.dilate(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ImageErodeNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{const r=new s.Mat,i=new s.Mat;s.erode(e,r,i,new s.Point(0,0),this.options.iterations?this.options.iterations:1),i.delete(),t(r)}))}}class ArucoMarkerNode extends ImageProcessingNode{constructor(e){super(e)}processImage(e){return new Promise((t=>{t(e)}))}}class ImageDisplaySink extends a.SinkNode{constructor(e){super(e),this.options.canvas=this.options.canvas||"debug"}onPush(e){return new Promise((t=>{s.imshow(this.options.canvas,e.image),t()}))}}var M=i.Xk,w=i.Fh,z=i.$E,N=i.eB,j=i.PS,O=i.gS,F=i.wk,I=i.sY,P=i.CW,x=i.s4,C=i.WH,D=i.yb,R=i.o9,A=i.h7,k=i.Tn,V=i.yA,_=i.aT,T=i.lc,B=i.LG,G=i.cv,E=i.j2;export{M as ArucoMarkerNode,w as CameraObject,z as ColorMaskNode,N as ColorOrder,j as DepthImageFrame,O as DepthVideoFrame,F as ImageDilateNode,I as ImageDisplaySink,P as ImageErodeNode,x as ImageFeatureObject,C as ImageFrame,D as ImageProcessingNode,R as ImageRectShape,A as PerspectiveCameraObject,k as StereoCameraObject,V as StereoImageFrame,_ as StereoVideoFrame,T as VideoFrame,B as VideoSource,G as cv,E as initialize};
//# sourceMappingURL=openhps-opencv.external.es.min.js.map