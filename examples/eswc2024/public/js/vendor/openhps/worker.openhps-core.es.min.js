/*! For license information please see worker.openhps-core.es.min.js.LICENSE.txt */
import*as __WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__ from"./openhps-core.es.min.js";var __webpack_modules__={114:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{var __dirname="/";__webpack_require__.d(__webpack_exports__,{e:()=>WorkerBase});var tslib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(582),reflect_metadata__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(660),reflect_metadata__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(reflect_metadata__WEBPACK_IMPORTED_MODULE_0__),threads_observable__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(978),___WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(19);class WorkerBase{constructor(){this.pullOutput=new threads_observable__WEBPACK_IMPORTED_MODULE_2__.xQ,this.pushOutput=new threads_observable__WEBPACK_IMPORTED_MODULE_2__.xQ,this.serviceOutputCall=new threads_observable__WEBPACK_IMPORTED_MODULE_2__.xQ,this.serviceOutputResponse=new threads_observable__WEBPACK_IMPORTED_MODULE_2__.xQ,this.eventOutput=new threads_observable__WEBPACK_IMPORTED_MODULE_2__.xQ,this.customMethods=new Map}setShape(e){this.shape=e}init(config){return new Promise(((resolve,reject)=>(0,tslib__WEBPACK_IMPORTED_MODULE_3__.mG)(this,void 0,void 0,(function*(){this.config=config;const importFn="object"!=typeof process?"module"===config.type?e=>import(e):e=>Promise.resolve(importScripts(e)):e=>Promise.resolve(__webpack_require__(653)(e));__dirname=config.directory,config.imports&&config.imports.length>0&&config.imports.forEach((e=>{importFn(e)}));const modelBuilder=___WEBPACK_IMPORTED_MODULE_1__.ModelBuilder.create();this.config.services.forEach((e=>{if(e.dataType){const t=___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.findTypeByName(e.dataType);modelBuilder.addService(new ___WEBPACK_IMPORTED_MODULE_1__.DummyDataService(e.uid,t),new ___WEBPACK_IMPORTED_MODULE_1__.WorkerServiceProxy({uid:e.uid,callObservable:this.serviceOutputCall,responseObservable:this.serviceOutputResponse}))}else modelBuilder.addService(new ___WEBPACK_IMPORTED_MODULE_1__.DummyService(e.uid),new ___WEBPACK_IMPORTED_MODULE_1__.WorkerServiceProxy({uid:e.uid,callObservable:this.serviceOutputCall,responseObservable:this.serviceOutputResponse}))})),this._initModel(modelBuilder);const path=this.config.imports.length>0||"object"!=typeof process?void 0:__webpack_require__(202);try{if(this.config.serialized){const e=modelBuilder.from(),t=___WEBPACK_IMPORTED_MODULE_1__.ModelSerializer.deserializeNode(this.config.serialized);e.via(t),e.to()}else if(this.config.builder){const traversalBuilder=modelBuilder.from(),builderCallback=eval(this.config.builder);builderCallback(traversalBuilder,modelBuilder,this.config.args),traversalBuilder.to()}else if(this.config.shape){const e=yield importFn(path?path.join(__dirname,this.config.shape):this.config.shape);e&&modelBuilder.addShape(e.default)}else this.shape&&modelBuilder.addShape(this.shape)}catch(e){return void reject(e)}modelBuilder.build().then((m=>{this.model=m,this.config.methods.forEach((serializedMethod=>{const method=eval(serializedMethod.handlerFn);this.customMethods.set(serializedMethod.name,((e,...t)=>Promise.resolve(method(e,...t))))})),resolve()})).catch(reject)}))))}invokeMethod(e,...t){return new Promise(((r,n)=>{const o=this.customMethods.get(e);if(!o)return n(new Error(`Unable to invoke unknown method '${e}'!`));o(this.model,...t.map((e=>___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.deserialize(e)))).then((e=>{r(___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.serialize(e))})).catch(n)}))}pull(e){return this.model.pull(e)}push(e,t){return this.model.push(___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.deserialize(e),t)}_initModel(e){const t=new ___WEBPACK_IMPORTED_MODULE_1__.CallbackSourceNode((e=>{this.pullOutput.next(e)})),r=new ___WEBPACK_IMPORTED_MODULE_1__.CallbackSinkNode((e=>{this.pushOutput.next(___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.serialize(e))}));e.graph.deleteNode(e.graph.internalSource),e.graph.internalSource=t,t.on("error",(e=>{this.eventOutput.next({name:"error",event:e})})),t.on("completed",(e=>{this.eventOutput.next({name:"completed",event:e})})),e.graph.addNode(e.graph.internalSource),e.graph.deleteNode(e.graph.internalSink),e.graph.internalSink=r,e.graph.addNode(e.graph.internalSink)}findAllServices(){return new Promise((e=>{e(this.model.findAllServices().filter((e=>!(e instanceof ___WEBPACK_IMPORTED_MODULE_1__.DummyDataService||e instanceof ___WEBPACK_IMPORTED_MODULE_1__.DummyService))).map((e=>{const t=Object.getPrototypeOf(e);return{uid:e.uid,type:t.constructor.name,dataType:e instanceof ___WEBPACK_IMPORTED_MODULE_1__.DataService?e.driver.dataType.name:void 0}})))}))}callService(e){return new Promise(((t,r)=>{const n=this.model.findDataService(e.serviceUID)||this.model.findService(e.serviceUID);if(n[e.method]){const o=e.parameters,i=[];o.forEach((e=>{e.__type?i.push(___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.deserialize(e)):i.push(e)}));const s=n[e.method](...i);Promise.resolve(s).then((r=>{if(Array.isArray(r)){const n=[];r.forEach((e=>{n.push(___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.serialize(e))})),t({id:e.id,success:!0,result:n})}else{const n=___WEBPACK_IMPORTED_MODULE_1__.DataSerializer.serialize(r);t({id:e.id,success:!0,result:n})}})).catch((t=>{r({id:e.id,success:!1,result:t})}))}}))}}},653:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=653,e.exports=t},227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(o=n))})),t.splice(o,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(447)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,r)=>{e.exports=function(e){function t(e){let r,o,i,s=null;function a(...e){if(!a.enabled)return;const n=a,o=Number(new Date),i=o-(r||o);n.diff=i,n.prev=r,n.curr=o,r=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,o)=>{if("%%"===r)return"%";s++;const i=t.formatters[o];if("function"==typeof i){const t=e[s];r=i.call(n,t),e.splice(s,1),s--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},898:e=>{e.exports=e=>!!e&&("symbol"==typeof Symbol.observable&&"function"==typeof e[Symbol.observable]?e===e[Symbol.observable]():"function"==typeof e["@@observable"]&&e===e["@@observable"]())},824:e=>{var t=1e3,r=60*t,n=60*r,o=24*n,i=7*o,s=365.25*o;function a(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,u){u=u||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var u=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*s;case"weeks":case"week":case"w":return u*i;case"days":case"day":case"d":return u*o;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(e);if("number"===c&&isFinite(e))return u.long?function(e){var i=Math.abs(e);if(i>=o)return a(e,i,o,"day");if(i>=n)return a(e,i,n,"hour");if(i>=r)return a(e,i,r,"minute");if(i>=t)return a(e,i,t,"second");return e+" ms"}(e):function(e){var i=Math.abs(e);if(i>=o)return Math.round(e/o)+"d";if(i>=n)return Math.round(e/n)+"h";if(i>=r)return Math.round(e/r)+"m";if(i>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},49:(e,t,r)=>{r.r(t),r.d(t,{Observable:()=>b,Subject:()=>S,filter:()=>E,flatMap:()=>P,interval:()=>C,map:()=>T,merge:()=>x,multicast:()=>j,scan:()=>W,unsubscribe:()=>g});var n=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};class AsyncSerialScheduler{constructor(e){this._baseObserver=e,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then((()=>this._baseObserver.complete())).catch((e=>this._baseObserver.error(e)))}error(e){this._baseObserver.error(e)}schedule(e){const t=Promise.all(this._pendingPromises),r=[],o=e=>r.push(e),i=Promise.resolve().then((()=>n(this,void 0,void 0,(function*(){yield t,yield e(o),this._pendingPromises.delete(i);for(const e of r)this._baseObserver.next(e)})))).catch((e=>{this._pendingPromises.delete(i),this._baseObserver.error(e)}));this._pendingPromises.add(i)}}const o=()=>"function"==typeof Symbol,i=e=>o()&&Boolean(Symbol[e]),s=e=>i(e)?Symbol[e]:"@@"+e;i("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const a=s("iterator"),u=s("observable"),c=s("species");function l(e,t){const r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function f(e){let t=e.constructor;return void 0!==t&&(t=t[c],null===t&&(t=void 0)),void 0!==t?t:Observable}function d(e){d.log?d.log(e):setTimeout((()=>{throw e}),0)}function p(e){Promise.resolve().then((()=>{try{e()}catch(e){d(e)}}))}function _(e){const t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{const e=l(t,"unsubscribe");e&&e.call(t)}}catch(e){d(e)}}function h(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function y(e,t,r){e._state="running";const n=e._observer;try{const o=n?l(n,t):void 0;switch(t){case"next":o&&o.call(n,r);break;case"error":if(h(e),!o)throw r;o.call(n,r);break;case"complete":h(e),o&&o.call(n)}}catch(e){d(e)}"closed"===e._state?_(e):"running"===e._state&&(e._state="ready")}function v(e,t,r){if("closed"!==e._state)return"buffering"===e._state?(e._queue=e._queue||[],void e._queue.push({type:t,value:r})):"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void p((()=>function(e){const t=e._queue;if(t){e._queue=void 0,e._state="ready";for(const r of t)if(y(e,r.type,r.value),"closed"===e._state)break}}(e)))):void y(e,t,r)}class Subscription{constructor(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";const r=new SubscriptionObserver(this);try{this._cleanup=t.call(void 0,r)}catch(e){r.error(e)}"initializing"===this._state&&(this._state="ready")}get closed(){return"closed"===this._state}unsubscribe(){"closed"!==this._state&&(h(this),_(this))}}class SubscriptionObserver{constructor(e){this._subscription=e}get closed(){return"closed"===this._subscription._state}next(e){v(this._subscription,"next",e)}error(e){v(this._subscription,"error",e)}complete(){v(this._subscription,"complete")}}class Observable{constructor(e){if(!(this instanceof Observable))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof e)throw new TypeError("Observable initializer must be a function");this._subscriber=e}subscribe(e,t,r){return"object"==typeof e&&null!==e||(e={next:e,error:t,complete:r}),new Subscription(e,this._subscriber)}pipe(e,...t){let r=this;for(const n of[e,...t])r=n(r);return r}tap(e,t,r){const n="object"!=typeof e||null===e?{next:e,error:t,complete:r}:e;return new Observable((e=>this.subscribe({next(t){n.next&&n.next(t),e.next(t)},error(t){n.error&&n.error(t),e.error(t)},complete(){n.complete&&n.complete(),e.complete()},start(e){n.start&&n.start(e)}})))}forEach(e){return new Promise(((t,r)=>{if("function"!=typeof e)return void r(new TypeError(e+" is not a function"));function n(){o.unsubscribe(),t(void 0)}const o=this.subscribe({next(t){try{e(t,n)}catch(e){r(e),o.unsubscribe()}},error(e){r(e)},complete(){t(void 0)}})}))}map(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(f(this))((t=>this.subscribe({next(r){let n=r;try{n=e(r)}catch(e){return t.error(e)}t.next(n)},error(e){t.error(e)},complete(){t.complete()}})))}filter(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(f(this))((t=>this.subscribe({next(r){try{if(!e(r))return}catch(e){return t.error(e)}t.next(r)},error(e){t.error(e)},complete(){t.complete()}})))}reduce(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");const r=f(this),n=arguments.length>1;let o=!1,i=t;return new r((t=>this.subscribe({next(r){const s=!o;if(o=!0,!s||n)try{i=e(i,r)}catch(e){return t.error(e)}else i=r},error(e){t.error(e)},complete(){if(!o&&!n)return t.error(new TypeError("Cannot reduce an empty sequence"));t.next(i),t.complete()}})))}concat(...e){const t=f(this);return new t((r=>{let n,o=0;return function i(s){n=s.subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){o===e.length?(n=void 0,r.complete()):i(t.from(e[o++]))}})}(this),()=>{n&&(n.unsubscribe(),n=void 0)}}))}flatMap(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=f(this);return new t((r=>{const n=[],o=this.subscribe({next(o){let s;if(e)try{s=e(o)}catch(e){return r.error(e)}else s=o;const a=t.from(s).subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){const e=n.indexOf(a);e>=0&&n.splice(e,1),i()}});n.push(a)},error(e){r.error(e)},complete(){i()}});function i(){o.closed&&0===n.length&&r.complete()}return()=>{n.forEach((e=>e.unsubscribe())),o.unsubscribe()}}))}[(Symbol.observable,u)](){return this}static from(e){const t="function"==typeof this?this:Observable;if(null==e)throw new TypeError(e+" is not an object");const r=l(e,u);if(r){const n=r.call(e);if(Object(n)!==n)throw new TypeError(n+" is not an object");return function(e){return e instanceof Observable}(n)&&n.constructor===t?n:new t((e=>n.subscribe(e)))}if(i("iterator")){const r=l(e,a);if(r)return new t((t=>{p((()=>{if(!t.closed){for(const n of r.call(e))if(t.next(n),t.closed)return;t.complete()}}))}))}if(Array.isArray(e))return new t((t=>{p((()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}}))}));throw new TypeError(e+" is not observable")}static of(...e){return new("function"==typeof this?this:Observable)((t=>{p((()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}}))}))}static get[c](){return this}}o()&&Object.defineProperty(Observable,Symbol("extensions"),{value:{symbol:u,hostReportError:d},configurable:!0});const b=Observable;const g=function(e){"function"==typeof e?e():e&&"function"==typeof e.unsubscribe&&e.unsubscribe()};var w=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};const E=function(e){return t=>new b((r=>{const n=new AsyncSerialScheduler(r),o=t.subscribe({complete(){n.complete()},error(e){n.error(e)},next(t){n.schedule((r=>w(this,void 0,void 0,(function*(){(yield e(t))&&r(t)}))))}});return()=>g(o)}))};var k=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},O=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,o,(t=e[r](t)).done,t.value)}))}}};const P=function(e){return t=>new b((r=>{const n=new AsyncSerialScheduler(r),o=t.subscribe({complete(){n.complete()},error(e){n.error(e)},next(t){n.schedule((r=>k(this,void 0,void 0,(function*(){var n,o;const s=yield e(t);if((c=s)&&i("iterator")&&c[Symbol.iterator]||function(e){return e&&i("asyncIterator")&&e[Symbol.asyncIterator]}(s))try{for(var a,u=O(s);!(a=yield u.next()).done;){const e=a.value;r(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(o=u.return)&&(yield o.call(u))}finally{if(n)throw n.error}}else s.map((e=>r(e)));var c}))))}});return()=>g(o)}))};function C(e){return new Observable((t=>{let r=0;const n=setInterval((()=>{t.next(r++)}),e);return()=>clearInterval(n)}))}var M=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};const T=function(e){return t=>new b((r=>{const n=new AsyncSerialScheduler(r),o=t.subscribe({complete(){n.complete()},error(e){n.error(e)},next(t){n.schedule((r=>M(this,void 0,void 0,(function*(){const n=yield e(t);r(n)}))))}});return()=>g(o)}))};const x=function(...e){return 0===e.length?Observable.from([]):new Observable((t=>{let r=0;const n=e.map((n=>n.subscribe({error(e){t.error(e),o()},next(e){t.next(e)},complete(){++r===e.length&&(t.complete(),o())}}))),o=()=>{n.forEach((e=>g(e)))};return o}))};const S=class MulticastSubject extends b{constructor(){super((e=>(this._observers.add(e),()=>this._observers.delete(e)))),this._observers=new Set}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){for(const e of this._observers)e.complete()}};const j=function(e){const t=new S;let r,n=0;return new b((o=>{r||(r=e.subscribe(t));const i=t.subscribe(o);return n++,()=>{n--,i.unsubscribe(),0===n&&(g(r),r=void 0)}}))};var D=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))};const W=function(e,t){return r=>new b((n=>{let o,i=0;const s=new AsyncSerialScheduler(n),a=r.subscribe({complete(){s.complete()},error(e){s.error(e)},next(r){s.schedule((n=>D(this,void 0,void 0,(function*(){const s=0===i?void 0===t?r:t:o;o=yield e(s,r,i++),n(o)}))))}});return()=>g(a)}))}},660:(e,t,r)=>{var n;!function(e){!function(t){var n="object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=i(e);function i(e,t){return function(r,n){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0===n.Reflect?n.Reflect=e:o=i(n.Reflect,o),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",i="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!i&&!s,u={create:i?function(){return oe(Object.create(null))}:s?function(){return oe({__proto__:null})}:function(){return oe({})},has:a?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:a?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,d=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?re():Set,p=new(l||"function"!=typeof WeakMap?ne():WeakMap);function _(e,t,r,n){if(A(r)){if(!N(e))throw new TypeError;if(!V(t))throw new TypeError;return P(e,t)}if(!N(e))throw new TypeError;if(!I(t))throw new TypeError;if(!I(n)&&!A(n)&&!F(n))throw new TypeError;return F(n)&&(n=void 0),C(e,t,r=q(r),n)}function h(e,t){function r(r,n){if(!I(r))throw new TypeError;if(!A(n)&&!X(n))throw new TypeError;D(e,t,r,n)}return r}function y(e,t,r,n){if(!I(r))throw new TypeError;return A(n)||(n=q(n)),D(e,t,r,n)}function v(e,t,r){if(!I(t))throw new TypeError;return A(r)||(r=q(r)),T(e,t,r)}function b(e,t,r){if(!I(t))throw new TypeError;return A(r)||(r=q(r)),x(e,t,r)}function g(e,t,r){if(!I(t))throw new TypeError;return A(r)||(r=q(r)),S(e,t,r)}function w(e,t,r){if(!I(t))throw new TypeError;return A(r)||(r=q(r)),j(e,t,r)}function E(e,t){if(!I(e))throw new TypeError;return A(t)||(t=q(t)),W(e,t)}function k(e,t){if(!I(e))throw new TypeError;return A(t)||(t=q(t)),z(e,t)}function O(e,t,r){if(!I(t))throw new TypeError;A(r)||(r=q(r));var n=M(t,r,!1);if(A(n))return!1;if(!n.delete(e))return!1;if(n.size>0)return!0;var o=p.get(t);return o.delete(r),o.size>0||p.delete(t),!0}function P(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!A(n)&&!F(n)){if(!V(n))throw new TypeError;t=n}}return t}function C(e,t,r,n){for(var o=e.length-1;o>=0;--o){var i=(0,e[o])(t,r,n);if(!A(i)&&!F(i)){if(!I(i))throw new TypeError;n=i}}return n}function M(e,t,r){var n=p.get(e);if(A(n)){if(!r)return;n=new f,p.set(e,n)}var o=n.get(t);if(A(o)){if(!r)return;o=new f,n.set(t,o)}return o}function T(e,t,r){if(x(e,t,r))return!0;var n=ee(t);return!F(n)&&T(e,n,r)}function x(e,t,r){var n=M(t,r,!1);return!A(n)&&K(n.has(e))}function S(e,t,r){if(x(e,t,r))return j(e,t,r);var n=ee(t);return F(n)?void 0:S(e,n,r)}function j(e,t,r){var n=M(t,r,!1);if(!A(n))return n.get(e)}function D(e,t,r,n){M(r,n,!0).set(e,t)}function W(e,t){var r=z(e,t),n=ee(e);if(null===n)return r;var o=W(n,t);if(o.length<=0)return r;if(r.length<=0)return o;for(var i=new d,s=[],a=0,u=r;a<u.length;a++){var c=u[a];i.has(c)||(i.add(c),s.push(c))}for(var l=0,f=o;l<f.length;l++){c=f[l];i.has(c)||(i.add(c),s.push(c))}return s}function z(e,t){var r=[],n=M(e,t,!1);if(A(n))return r;for(var o=Z(n.keys()),i=0;;){var s=G(o);if(!s)return r.length=i,r;var a=H(s);try{r[i]=a}catch(e){try{Y(o)}finally{throw e}}i++}}function R(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function A(e){return void 0===e}function F(e){return null===e}function L(e){return"symbol"==typeof e}function I(e){return"object"==typeof e?null!==e:"function"==typeof e}function B(e,t){switch(R(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",o=J(e,n);if(void 0!==o){var i=o.call(e,r);if(I(i))throw new TypeError;return i}return U(e,"default"===r?"number":r)}function U(e,t){if("string"===t){var r=e.toString;if(Q(r))if(!I(o=r.call(e)))return o;if(Q(n=e.valueOf))if(!I(o=n.call(e)))return o}else{var n;if(Q(n=e.valueOf))if(!I(o=n.call(e)))return o;var o,i=e.toString;if(Q(i))if(!I(o=i.call(e)))return o}throw new TypeError}function K(e){return!!e}function $(e){return""+e}function q(e){var t=B(e,3);return L(t)?t:$(t)}function N(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function Q(e){return"function"==typeof e}function V(e){return"function"==typeof e}function X(e){switch(R(e)){case 3:case 4:return!0;default:return!1}}function J(e,t){var r=e[t];if(null!=r){if(!Q(r))throw new TypeError;return r}}function Z(e){var t=J(e,o);if(!Q(t))throw new TypeError;var r=t.call(e);if(!I(r))throw new TypeError;return r}function H(e){return e.value}function G(e){var t=e.next();return!t.done&&t}function Y(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var o=n.constructor;return"function"!=typeof o||o===e?t:o}function te(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,o=r+1;o<n;o++)this._keys[o-1]=this._keys[o],this._values[o-1]=this._values[o];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,i)},t.prototype.entries=function(){return new r(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function i(e,t){return t}function s(e,t){return[e,t]}}function re(){return function(){function e(){this._map=new f}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}()}function ne(){var e=16,r=u.create(),n=o();return function(){function e(){this._key=o()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=o()},e}();function o(){var e;do{e="@@WeakMap@@"+c()}while(u.has(r,e));return r[e]=!0,e}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function s(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function c(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var r="",n=0;n<e;++n){var o=t[n];4!==n&&6!==n&&8!==n||(r+="-"),o<16&&(r+="0"),r+=o.toString(16).toLowerCase()}return r}}function oe(e){return e.__=void 0,delete e.__,e}e("decorate",_),e("metadata",h),e("defineMetadata",y),e("hasMetadata",v),e("hasOwnMetadata",b),e("getMetadata",g),e("getOwnMetadata",w),e("getMetadataKeys",E),e("getOwnMetadataKeys",k),e("deleteMetadata",O)}(o)}()}(n||(n={}))},467:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.deserialize=t.registerSerializer=void 0;const n=r(381);let o=n.DefaultSerializer;t.registerSerializer=function(e){o=n.extendSerializer(o,e)},t.deserialize=function(e){return o.deserialize(e)},t.serialize=function(e){return o.serialize(e)}},734:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.DefaultSerializer=t.expose=t.registerSerializer=void 0;var i=r(467);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return i.registerSerializer}}),o(r(63),t);var s=r(934);Object.defineProperty(t,"expose",{enumerable:!0,get:function(){return s.expose}});var a=r(381);Object.defineProperty(t,"DefaultSerializer",{enumerable:!0,get:function(){return a.DefaultSerializer}});var u=r(180);Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return u.Transfer}})},211:(e,t)=>{let r;function n(e){return(""+e).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Object.defineProperty(t,"__esModule",{value:!0}),t.getBundleURL=t.getBaseURL=void 0,t.getBundleURL=function(){return r||(r=function(){try{throw new Error}catch(e){const t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return n(t[0])}return"/"}()),r},t.getBaseURL=n},390:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerRuntime=t.getWorkerImplementation=t.defaultPoolSize=void 0;const n=r(211);t.defaultPoolSize="undefined"!=typeof navigator&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const o=e=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e);function i(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}let s;t.getWorkerImplementation=function(){return s||(s=function(){if("undefined"==typeof Worker)return class NoWebWorker{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class WebWorker extends Worker{constructor(e,t){var r,s;"string"==typeof e&&t&&t._baseURL?e=new URL(e,t._baseURL):"string"==typeof e&&!o(e)&&n.getBundleURL().match(/^file:\/\//i)&&(e=new URL(e,n.getBundleURL().replace(/\/[^\/]+$/,"/")),(null===(r=null==t?void 0:t.CORSWorkaround)||void 0===r||r)&&(e=i(`importScripts(${JSON.stringify(e)});`))),"string"==typeof e&&o(e)&&(null===(s=null==t?void 0:t.CORSWorkaround)||void 0===s||s)&&(e=i(`importScripts(${JSON.stringify(e)});`)),super(e,t)}}class BlobWorker extends WebWorker{constructor(e,t){super(window.URL.createObjectURL(e),t)}static fromText(e,t){const r=new window.Blob([e],{type:"text/javascript"});return new BlobWorker(r,t)}}return{blob:BlobWorker,default:WebWorker}}()),s},t.isWorkerRuntime=function(){const e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)}},63:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Worker=t.BlobWorker=t.isWorkerRuntime=t.Thread=t.spawn=t.Pool=void 0;const n=r(390);Object.defineProperty(t,"isWorkerRuntime",{enumerable:!0,get:function(){return n.isWorkerRuntime}});var o=r(337);Object.defineProperty(t,"Pool",{enumerable:!0,get:function(){return o.Pool}});var i=r(264);Object.defineProperty(t,"spawn",{enumerable:!0,get:function(){return i.spawn}});var s=r(235);Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return s.Thread}}),t.BlobWorker=n.getWorkerImplementation().blob,t.Worker=n.getWorkerImplementation().default},891:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createProxyModule=t.createProxyFunction=void 0;const o=n(r(227)),i=r(49),s=r(467),a=r(15),u=r(180),c=r(229),l=o.default("threads:master:messages");let f=1;const d=e=>Array.from(new Set(e)),p=e=>e&&e.type===c.WorkerMessageType.error,_=e=>e&&e.type===c.WorkerMessageType.result,h=e=>e&&e.type===c.WorkerMessageType.running;function y(e,t){return(...r)=>{const n=f++,{args:o,transferables:y}=function(e){if(0===e.length)return{args:[],transferables:[]};const t=[],r=[];for(const n of e)u.isTransferDescriptor(n)?(t.push(s.serialize(n.send)),r.push(...n.transferables)):t.push(s.serialize(n));return{args:t,transferables:0===r.length?r:d(r)}}(r),v={type:c.MasterMessageType.run,uid:n,method:t,args:o};l("Sending command to run function to worker:",v);try{e.postMessage(v,y)}catch(e){return a.ObservablePromise.from(Promise.reject(e))}return a.ObservablePromise.from(i.multicast(function(e,t){return new i.Observable((r=>{let n;const o=i=>{if(l("Message from worker:",i.data),i.data&&i.data.uid===t)if(h(i.data))n=i.data.resultType;else if(_(i.data))"promise"===n?(void 0!==i.data.payload&&r.next(s.deserialize(i.data.payload)),r.complete(),e.removeEventListener("message",o)):(i.data.payload&&r.next(s.deserialize(i.data.payload)),i.data.complete&&(r.complete(),e.removeEventListener("message",o)));else if(p(i.data)){const t=s.deserialize(i.data.error);r.error(t),e.removeEventListener("message",o)}};return e.addEventListener("message",o),()=>{if("observable"===n||!n){const r={type:c.MasterMessageType.cancel,uid:t};e.postMessage(r)}e.removeEventListener("message",o)}}))}(e,n)))}}t.createProxyFunction=y,t.createProxyModule=function(e,t){const r={};for(const n of t)r[n]=y(e,n);return r}},774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PoolEventType=void 0,function(e){e.initialized="initialized",e.taskCanceled="taskCanceled",e.taskCompleted="taskCompleted",e.taskFailed="taskFailed",e.taskQueued="taskQueued",e.taskQueueDrained="taskQueueDrained",e.taskStart="taskStart",e.terminated="terminated"}(t.PoolEventType||(t.PoolEventType={}))},337:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Pool=t.Thread=t.PoolEventType=void 0;const i=o(r(227)),s=r(49),a=r(531),u=r(390),c=r(774);Object.defineProperty(t,"PoolEventType",{enumerable:!0,get:function(){return c.PoolEventType}});const l=r(235);Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return l.Thread}});let f=1;class WorkerPool{constructor(e,t){this.eventSubject=new s.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const r="number"==typeof t?{size:t}:t||{},{size:n=u.defaultPoolSize}=r;var o;this.debug=i.default(`threads:pool:${o=r.name||String(f++),o.replace(/\W/g," ").trim().replace(/\s+/g,"-")}`),this.options=r,this.workers=function(e,t){return function(e){const t=[];for(let r=0;r<e;r++)t.push(r);return t}(t).map((()=>({init:e(),runningTasks:[]})))}(e,n),this.eventObservable=s.multicast(s.Observable.from(this.eventSubject)),Promise.all(this.workers.map((e=>e.init))).then((()=>this.eventSubject.next({type:c.PoolEventType.initialized,size:this.workers.length})),(e=>{this.debug("Error while initializing pool worker:",e),this.eventSubject.error(e),this.initErrors.push(e)}))}findIdlingWorker(){const{concurrency:e=1}=this.options;return this.workers.find((t=>t.runningTasks.length<e))}runPoolTask(e,t){return n(this,void 0,void 0,(function*(){const r=this.workers.indexOf(e)+1;this.debug(`Running task #${t.id} on worker #${r}...`),this.eventSubject.next({type:c.PoolEventType.taskStart,taskID:t.id,workerID:r});try{const n=yield t.run(yield e.init);this.debug(`Task #${t.id} completed successfully`),this.eventSubject.next({type:c.PoolEventType.taskCompleted,returnValue:n,taskID:t.id,workerID:r})}catch(e){this.debug(`Task #${t.id} failed`),this.eventSubject.next({type:c.PoolEventType.taskFailed,taskID:t.id,error:e,workerID:r})}}))}run(e,t){return n(this,void 0,void 0,(function*(){const r=(()=>n(this,void 0,void 0,(function*(){var n;yield(n=0,new Promise((e=>setTimeout(e,n))));try{yield this.runPoolTask(e,t)}finally{e.runningTasks=e.runningTasks.filter((e=>e!==r)),this.isClosing||this.scheduleWork()}})))();e.runningTasks.push(r)}))}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const e=this.findIdlingWorker();if(!e)return;const t=this.taskQueue.shift();if(!t)return this.debug("Task queue is empty"),void this.eventSubject.next({type:c.PoolEventType.taskQueueDrained});this.run(e,t)}taskCompletion(e){return new Promise(((t,r)=>{const n=this.events().subscribe((o=>{o.type===c.PoolEventType.taskCompleted&&o.taskID===e?(n.unsubscribe(),t(o.returnValue)):o.type===c.PoolEventType.taskFailed&&o.taskID===e?(n.unsubscribe(),r(o.error)):o.type===c.PoolEventType.terminated&&(n.unsubscribe(),r(Error("Pool has been terminated before task was run.")))}))}))}settled(e=!1){return n(this,void 0,void 0,(function*(){const t=()=>{return e=this.workers,t=e=>e.runningTasks,e.reduce(((e,r)=>[...e,...t(r)]),[]);var e,t},r=[],n=this.eventObservable.subscribe((e=>{e.type===c.PoolEventType.taskFailed&&r.push(e.error)}));return this.initErrors.length>0?Promise.reject(this.initErrors[0]):e&&0===this.taskQueue.length?(yield a.allSettled(t()),r):(yield new Promise(((e,t)=>{const r=this.eventObservable.subscribe({next(t){t.type===c.PoolEventType.taskQueueDrained&&(r.unsubscribe(),e(void 0))},error:t})})),yield a.allSettled(t()),n.unsubscribe(),r)}))}completed(e=!1){return n(this,void 0,void 0,(function*(){const t=this.settled(e),r=new Promise(((e,r)=>{const n=this.eventObservable.subscribe({next(o){o.type===c.PoolEventType.taskQueueDrained?(n.unsubscribe(),e(t)):o.type===c.PoolEventType.taskFailed&&(n.unsubscribe(),r(o.error))},error:r})})),n=yield Promise.race([t,r]);if(n.length>0)throw n[0]}))}events(){return this.eventObservable}queue(e){const{maxQueuedJobs:t=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const r=this.nextTaskID++,n=this.taskCompletion(r);n.catch((e=>{this.debug(`Task #${r} errored:`,e)}));const o={id:r,run:e,cancel:()=>{-1!==this.taskQueue.indexOf(o)&&(this.taskQueue=this.taskQueue.filter((e=>e!==o)),this.eventSubject.next({type:c.PoolEventType.taskCanceled,taskID:o.id}))},then:n.then.bind(n)};if(this.taskQueue.length>=t)throw Error("Maximum number of pool tasks queued. Refusing to queue another one.\nThis usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.");return this.debug(`Queueing task #${o.id}...`),this.taskQueue.push(o),this.eventSubject.next({type:c.PoolEventType.taskQueued,taskID:o.id}),this.scheduleWork(),o}terminate(e){return n(this,void 0,void 0,(function*(){this.isClosing=!0,e||(yield this.completed(!0)),this.eventSubject.next({type:c.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map((e=>n(this,void 0,void 0,(function*(){return l.Thread.terminate(yield e.init)})))))}))}}function d(e,t){return new WorkerPool(e,t)}WorkerPool.EventType=c.PoolEventType,d.EventType=c.PoolEventType,t.Pool=d},264:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.spawn=void 0;const i=o(r(227)),s=r(49),a=r(467),u=r(104),c=r(258),l=r(356),f=r(891),d=i.default("threads:master:messages"),p=i.default("threads:master:spawn"),_=i.default("threads:master:thread-utils"),h=e=>e&&"init"===e.type,y=e=>e&&"uncaughtError"===e.type,v="undefined"!=typeof process&&process.env.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt(process.env.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function b(e,t,r,n){const o=r.filter((e=>e.type===l.WorkerEventType.internalError)).map((e=>e.error));return Object.assign(e,{[c.$errors]:o,[c.$events]:r,[c.$terminate]:n,[c.$worker]:t})}t.spawn=function(e,t){return n(this,void 0,void 0,(function*(){p("Initializing new thread");const r=t&&t.timeout?t.timeout:v,o=yield function(e,t,r){return n(this,void 0,void 0,(function*(){let n;const o=new Promise(((e,o)=>{n=setTimeout((()=>o(Error(r))),t)})),i=yield Promise.race([e,o]);return clearTimeout(n),i}))}(function(e){return new Promise(((t,r)=>{const n=o=>{d("Message from worker before finishing initialization:",o.data),h(o.data)?(e.removeEventListener("message",n),t(o.data)):y(o.data)&&(e.removeEventListener("message",n),r(a.deserialize(o.data.error)))};e.addEventListener("message",n)}))}(e),r,`Timeout: Did not receive an init message from worker after ${r}ms. Make sure the worker calls expose().`),i=o.exposed,{termination:c,terminate:g}=function(e){const[t,r]=u.createPromiseWithResolver();return{terminate:()=>n(this,void 0,void 0,(function*(){_("Terminating worker"),yield e.terminate(),r()})),termination:t}}(e),w=function(e,t){return new s.Observable((r=>{const n=e=>{const t={type:l.WorkerEventType.message,data:e.data};r.next(t)},o=e=>{_("Unhandled promise rejection event in thread:",e);const t={type:l.WorkerEventType.internalError,error:Error(e.reason)};r.next(t)};e.addEventListener("message",n),e.addEventListener("unhandledrejection",o),t.then((()=>{const t={type:l.WorkerEventType.termination};e.removeEventListener("message",n),e.removeEventListener("unhandledrejection",o),r.next(t),r.complete()}))}))}(e,c);if("function"===i.type){return b(f.createProxyFunction(e),e,w,g)}if("module"===i.type){return b(f.createProxyModule(e,i.methods),e,w,g)}{const e=i.type;throw Error(`Worker init message states unexpected type of expose(): ${e}`)}}))}},235:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Thread=void 0;const n=r(258);function o(e){throw Error(e)}t.Thread={errors:e=>e[n.$errors]||o("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),events:e=>e[n.$events]||o("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),terminate:e=>e[n.$terminate]()}},15:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObservablePromise=void 0;const n=r(49),o=()=>{},i=e=>e,s=e=>Promise.resolve().then(e);function a(e){throw e}class ObservablePromise extends n.Observable{constructor(e){super((t=>{const r=this,n=Object.assign(Object.assign({},t),{complete(){t.complete(),r.onCompletion()},error(e){t.error(e),r.onError(e)},next(e){t.next(e),r.onNext(e)}});try{return this.initHasRun=!0,e(n)}catch(e){n.error(e)}})),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(e){this.firstValueSet||(this.firstValue=e,this.firstValueSet=!0)}onError(e){this.state="rejected",this.rejection=e;for(const t of this.rejectionCallbacks)s((()=>t(e)))}onCompletion(){this.state="fulfilled";for(const e of this.fulfillmentCallbacks)s((()=>e(this.firstValue)))}then(e,t){const r=e||i,n=t||a;let o=!1;return new Promise(((e,t)=>{const i=r=>{if(!o){o=!0;try{e(n(r))}catch(e){t(e)}}};return this.initHasRun||this.subscribe({error:i}),"fulfilled"===this.state?e(r(this.firstValue)):"rejected"===this.state?(o=!0,e(n(this.rejection))):(this.fulfillmentCallbacks.push((t=>{try{e(r(t))}catch(e){i(e)}})),void this.rejectionCallbacks.push(i))}))}catch(e){return this.then(void 0,e)}finally(e){const t=e||o;return this.then((e=>(t(),e)),(()=>t()))}static from(e){return function(e){return e&&"function"==typeof e.then}(e)?new ObservablePromise((t=>{e.then((e=>{t.next(e),t.complete()}),(e=>{t.error(e)}))})):super.from(e)}}t.ObservablePromise=ObservablePromise},978:(e,t,r)=>{t.xQ=t.y$=void 0;const n=r(49);Object.defineProperty(t,"y$",{enumerable:!0,get:function(){return n.Observable}});const o=Symbol("observers");class Subject extends n.Observable{constructor(){super((e=>{this[o]=[...this[o]||[],e];return()=>{this[o]=this[o].filter((t=>t!==e))}})),this[o]=[]}complete(){this[o].forEach((e=>e.complete()))}error(e){this[o].forEach((t=>t.error(e)))}next(e){this[o].forEach((t=>t.next(e)))}}t.xQ=Subject},531:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.allSettled=void 0,t.allSettled=function(e){return Promise.all(e.map((e=>{const t=e=>({status:"fulfilled",value:e}),r=e=>({status:"rejected",reason:e}),n=Promise.resolve(e);try{return n.then(t,r)}catch(e){return Promise.reject(e)}})))}},104:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseWithResolver=void 0;const r=()=>{};t.createPromiseWithResolver=function(){let e,t=!1,n=r;return[new Promise((r=>{t?r(e):n=r})),r=>{t=!0,e=r,n(e)}]}},381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSerializer=t.extendSerializer=void 0,t.extendSerializer=function(e,t){const r=e.deserialize.bind(e),n=e.serialize.bind(e);return{deserialize:e=>t.deserialize(e,r),serialize:e=>t.serialize(e,n)}};const r={deserialize:e=>Object.assign(Error(e.message),{name:e.name,stack:e.stack}),serialize:e=>({__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack})};t.DefaultSerializer={deserialize(e){return(t=e)&&"object"==typeof t&&"__error_marker"in t&&"$$error"===t.__error_marker?r.deserialize(e):e;var t},serialize:e=>e instanceof Error?r.serialize(e):e}},258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$worker=t.$transferable=t.$terminate=t.$events=t.$errors=void 0,t.$errors=Symbol("thread.errors"),t.$events=Symbol("thread.events"),t.$terminate=Symbol("thread.terminate"),t.$transferable=Symbol("thread.transferable"),t.$worker=Symbol("thread.worker")},180:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.isTransferDescriptor=void 0;const n=r(258);t.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[n.$transferable]},t.Transfer=function(e,t){if(!t){if(!(r=e)||"object"!=typeof r)throw Error();t=[e]}var r;return{[n.$transferable]:!0,send:e,transferables:t}}},356:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerEventType=void 0;r(258);!function(e){e.internalError="internalError",e.message="message",e.termination="termination"}(t.WorkerEventType||(t.WorkerEventType={}))},229:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerMessageType=t.MasterMessageType=void 0,function(e){e.cancel="cancel",e.run="run"}(t.MasterMessageType||(t.MasterMessageType={})),function(e){e.error="error",e.init="init",e.result="result",e.running="running",e.uncaughtError="uncaughtError"}(t.WorkerMessageType||(t.WorkerMessageType={}))},398:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default={isWorkerRuntime:function(){const e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}}},934:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.expose=t.isWorkerRuntime=t.Transfer=t.registerSerializer=void 0;const i=o(r(898)),s=r(467),a=r(180),u=r(229),c=o(r(398));var l=r(467);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var f=r(180);Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return f.Transfer}}),t.isWorkerRuntime=c.default.isWorkerRuntime;let d=!1;const p=new Map,_=e=>e&&e.type===u.MasterMessageType.run,h=e=>i.default(e)||function(e){return e&&"object"==typeof e&&"function"==typeof e.subscribe}(e);function y(e){return a.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function v(e,t){const{payload:r,transferables:n}=y(t),o={type:u.WorkerMessageType.error,uid:e,error:s.serialize(r)};c.default.postMessageToMaster(o,n)}function b(e,t,r){const{payload:n,transferables:o}=y(r),i={type:u.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:n};c.default.postMessageToMaster(i,o)}function g(e){try{const t={type:u.WorkerMessageType.uncaughtError,error:s.serialize(e)};c.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",t,"\nOriginal error:",e)}}function w(e,t,r){return n(this,void 0,void 0,(function*(){let n;try{n=t(...r)}catch(t){return v(e,t)}const o=h(n)?"observable":"promise";if(function(e,t){const r={type:u.WorkerMessageType.running,uid:e,resultType:t};c.default.postMessageToMaster(r)}(e,o),h(n)){const t=n.subscribe((t=>b(e,!1,s.serialize(t))),(t=>{v(e,s.serialize(t)),p.delete(e)}),(()=>{b(e,!0),p.delete(e)}));p.set(e,t)}else try{const t=yield n;b(e,!0,s.serialize(t))}catch(t){v(e,s.serialize(t))}}))}t.expose=function(e){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(d)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(d=!0,"function"==typeof e)c.default.subscribeToMasterMessages((t=>{_(t)&&!t.method&&w(t.uid,e,t.args.map(s.deserialize))})),function(){const e={type:u.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(e)}();else{if("object"!=typeof e||!e)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${e}`);c.default.subscribeToMasterMessages((t=>{_(t)&&t.method&&w(t.uid,e[t.method],t.args.map(s.deserialize))}));!function(e){const t={type:u.WorkerMessageType.init,exposed:{type:"module",methods:e}};c.default.postMessageToMaster(t)}(Object.keys(e).filter((t=>"function"==typeof e[t])))}c.default.subscribeToMasterMessages((e=>{if((t=e)&&t.type===u.MasterMessageType.cancel){const t=e.uid,r=p.get(t);r&&(r.unsubscribe(),p.delete(t))}var t}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",(e=>{setTimeout((()=>g(e.error||e)),250)})),self.addEventListener("unhandledrejection",(e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout((()=>g(t)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",(e=>{setTimeout((()=>g(e)),250)})),process.on("unhandledRejection",(e=>{e&&"string"==typeof e.message&&setTimeout((()=>g(e)),250)})))},19:(e,t,r)=>{e.exports=(e=>{var t={};return r.d(t,e),t})({CallbackSinkNode:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.CallbackSinkNode,CallbackSourceNode:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.CallbackSourceNode,DataSerializer:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.DataSerializer,DataService:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.DataService,DummyDataService:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.DummyDataService,DummyService:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.DummyService,ModelBuilder:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.ModelBuilder,ModelSerializer:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.ModelSerializer,WorkerServiceProxy:()=>__WEBPACK_EXTERNAL_MODULE__openhps_core_es_min_js_27733f5f__.WorkerServiceProxy})},202:()=>{},582:(e,t,r)=>{r.d(t,{mG:()=>n});function n(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}u((n=n.apply(e,t||[])).next())}))}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{__webpack_require__.d(__webpack_exports__,{Z:()=>n});__webpack_require__(660);var e=__webpack_require__(978),t=__webpack_require__(734);const r=new(__webpack_require__(114).e);(0,t.expose)({init:e=>r.init(e),pull:e=>r.pull(e),push:(e,t)=>r.push(e,t),pullOutput:()=>e.y$.from(r.pullOutput),pushOutput:()=>e.y$.from(r.pushOutput),eventOutput:()=>e.y$.from(r.eventOutput),eventInput(e,t){r.model.emit(e,t)},serviceOutputCall:()=>e.y$.from(r.serviceOutputCall),serviceOutputResponse(e){r.serviceOutputResponse.next(e)},serviceInputCall:e=>r.callService(e),findAllServices:()=>r.findAllServices(),invokeMethod:(e,...t)=>r.invokeMethod(e,...t)});const n=r})();var __webpack_exports__default=__webpack_exports__.Z;export{__webpack_exports__default as default};
//# sourceMappingURL=worker.openhps-core.es.min.js.map